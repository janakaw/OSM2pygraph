<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDqcTmAwMlVBUk-yEAECaY0YcAjSNbWo40&sensor=false">
    </script>
    <script type="text/javascript">
	var request=new XMLHttpRequest();
      	var count=0;
	var center_str;
	var point_array;
	
	
     function user_list(){
	count=0;
	var url="geolife_user_list_sql.php";
	if(request!=null){
		request.open("GET",url,true);
		request.onreadystatechange = on_user_list;
		request.send(null);
	} 
      }
	
     function on_user_list(){
	var str = request.responseText;	
	var user_list = str.split(",");
	count++;
	if(count==3){	
		var user_list_div_id = document.getElementById('ul');
		var user_list_id = document.createElement('select');
		user_list_id.setAttribute('id','uls');
		user_list_id.name = 'user';
		

		var x;
		for(x in user_list){
			var next_user_id = document.createElement('option');
			next_user_id.name = 'user';
			next_user_id.value = user_list[x];
			next_user_id.text = user_list[x];			
			user_list_id.appendChild(next_user_id);
		}
		user_list_id.onchange = user_traj_list;
		user_list_div_id.appendChild(user_list_id);
	}
     }

     function user_traj_list(){
	count=0;
	var user_id = document.getElementById("uls").value;
	var url="geolife_trajectory_list_sql.php?user=" + escape(user_id);
	
	if(request!=null){
		request.open("GET",url,true);
		request.onreadystatechange = on_traj_list;
		request.send(null);
	} 
      }

     function on_traj_list(){

	var str = request.responseText;	
	var trajectory_list = str.split(",");	
		count++;
	if(count==4){
		var trajectory_list_div_id = document.getElementById('tl');

		var trajectory_list_id = document.getElementById('tls');
		if(trajectory_list_id != null){
			trajectory_list_div_id.removeChild(trajectory_list_id);
		}
		var trajectory_list_id = document.createElement('select');
		trajectory_list_id.setAttribute('id','tls');
		trajectory_list_id.name = 'trajectory';
		var x;
		for(x in trajectory_list){
			var next_trajectory_id = document.createElement('option');
			next_trajectory_id.name = 'trajectory';
			next_trajectory_id.value = trajectory_list[x];
			next_trajectory_id.text = trajectory_list[x];			
			trajectory_list_id.appendChild(next_trajectory_id);
		}
		trajectory_list_id.onchange = user_traj;
		trajectory_list_div_id.appendChild(trajectory_list_id);
	}
     }

     function user_traj(){
	count=0;
	var user_id = document.getElementById("uls").value;
	var trajectory_id = document.getElementById("tls").value;
	var url="geolife_trajectory_points_sql.php?user=" + escape(user_id) + "&trajectory=" + escape(trajectory_id);
	if(request!=null){
		request.open("GET",url,true);
		request.onreadystatechange = on_user_traj;
		request.send(null);
	} 
      }

      function on_user_traj(){
	count++;
	var str = request.responseText;
	if(count==4){
		var arry1 = str.split(":");
		center_str = arry1[0];
		alert(center_str);
		point_array=arry1[1];	
		alert(point_array);
		draw_trajectory();
	}

      }
   
	
    </script>
  </head>
  <body onload="user_list()">
	<div id="main"><form action="geolife_trajectories_list.php"><table border="0">
        <tr><td><div style="color:#FFFFFF">..........</div></td><td><div id="ul"></div></td><td><div id="tl"></div></td><td id="4"><input type="submit" value="List Trajectories"></td></tr>
	<tr><div id="map_canvas" style="width:100%; height:100%"></div></tr>
        </table></form></div>
  </body>
</html>
